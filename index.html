<script>
    let clientes = JSON.parse(localStorage.getItem('vehiculos')) || [];
    let vehiculosRetirados = JSON.parse(localStorage.getItem('vehiculosRetirados')) || [];

    const tarifaPorMinuto = 0.5; // Tarifa por minuto en Quetzales

    // Función para ingresar un vehículo
    function ingresarVehiculo() {
        const placa = document.getElementById('placa').value.trim();
        const marca = document.getElementById('marca').value.trim();

        if (!placa || !marca) {
            alert('Por favor, complete todos los campos.');
            return;
        }

        const horaIngreso = new Date(); // Hora actual
        const vehiculo = { placa, marca, horaIngreso: horaIngreso.toISOString() }; // Guardamos horaIngreso como ISO string

        console.log("Vehículo ingresado:", vehiculo);

        clientes.push(vehiculo);
        localStorage.setItem('vehiculos', JSON.stringify(clientes)); // Guardamos el array actualizado

        actualizarTabla();
        document.getElementById('placa').value = '';
        document.getElementById('marca').value = '';
    }

    // Función para retirar un vehículo
    function retirarVehiculo(placa) {
        const vehiculo = clientes.find(v => v.placa === placa);
        const tarifa = calcularTarifa(new Date(vehiculo.horaIngreso));
        const fechaSalida = new Date().toLocaleString();

        vehiculosRetirados.push({ ...vehiculo, tarifaCobrada: tarifa, fechaSalida });
        clientes = clientes.filter(v => v.placa !== placa);

        localStorage.setItem('vehiculos', JSON.stringify(clientes));
        localStorage.setItem('vehiculosRetirados', JSON.stringify(vehiculosRetirados));

        actualizarTabla();
        actualizarTablaRetirados();
    }

    // Función para calcular la tarifa
    function calcularTarifa(horaIngreso) {
        const tiempoEnParqueo = Math.floor((new Date() - horaIngreso) / 1000 / 60); // En minutos
        return tiempoEnParqueo * tarifaPorMinuto;
    }

    // Función para visualizar la tarifa de un vehículo
    function visualizarTarifa(placa) {
        const vehiculo = clientes.find(v => v.placa === placa);
        const tarifa = calcularTarifa(new Date(vehiculo.horaIngreso));
        alert(`La tarifa actual para el vehículo con placa ${placa} es: Q${tarifa.toFixed(2)}`);
    }

    // Función para actualizar la tabla de vehículos en parqueo
    function actualizarTabla() {
        const tabla = document.getElementById('tablaClientes');
        tabla.innerHTML = `
            <tr>
                <th>Placa</th>
                <th>Marca</th>
                <th>Tiempo en Parqueo</th>
                <th>Tarifa</th>
                <th>Acciones</th>
            </tr>
        `;
        clientes.forEach((vehiculo) => {
            const fechaIngreso = new Date(vehiculo.horaIngreso);
            const tiempoEnParqueo = Math.floor((new Date() - fechaIngreso) / 1000 / 60); // En minutos
            const fila = document.createElement('tr');
            fila.id = `cliente-${fechaIngreso.getTime()}`;
            fila.innerHTML = `
                <td>${vehiculo.placa}</td>
                <td>${vehiculo.marca}</td>
                <td class="tiempo">${tiempoEnParqueo} min</td>
                <td>Q${calcularTarifa(fechaIngreso).toFixed(2)}</td>
                <td>
                    <button onclick="retirarVehiculo('${vehiculo.placa}')">Retirar</button>
                    <button onclick="visualizarTarifa('${vehiculo.placa}')">Ver Tarifa</button>
                </td>
            `;
            tabla.appendChild(fila);
        });
    }

    // Función para actualizar la tabla de vehículos retirados
    function actualizarTablaRetirados() {
        const tabla = document.getElementById('tablaVehiculosRetirados');
        tabla.innerHTML = `
            <tr>
                <th>Placa</th>
                <th>Marca</th>
                <th>Tarifa Cobrada</th>
                <th>Fecha de Salida</th>
                <th>Acciones</th>
            </tr>
        `;
        vehiculosRetirados.forEach((vehiculo) => {
            const fila = document.createElement('tr');
            fila.innerHTML = `
                <td>${vehiculo.placa}</td>
                <td>${vehiculo.marca}</td>
                <td>Q${vehiculo.tarifaCobrada.toFixed(2)}</td>
                <td>${vehiculo.fechaSalida}</td>
                <td><button onclick="imprimirVenta('${vehiculo.placa}', ${vehiculo.tarifaCobrada})">Imprimir</button></td>
            `;
            tabla.appendChild(fila);
        });
    }

    // Inicializar tablas al cargar la página
    document.addEventListener('DOMContentLoaded', () => {
        actualizarTabla();
        actualizarTablaRetirados();
    });
</script>

